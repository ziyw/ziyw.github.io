---
layout: post
title: 'Minimal JDBC Example' 
---

The idea is simple: use JDBC to connect to DB, query, get results. 

Why doing this: 
- Bare metal JDBC is the fundation of higher level Java DB APIs (Spring JDBC)
- Figuring out how to use docker with Database will come handy for future project
- At some point in life, the number of wrappers is just overwhelming. Creating this bare metal implementation clears my mind from all the layers of layers of wrappers and abstraction and dependency and indrection. 

The goal is to create **Simple, Readable, Buildable** code. 

There are two parts of this example, first is a docker app for PostgreSQL DB with preloaded table, second is a small Java project use JDBC to connect to the database. 

Pre-requisite: docker, maven

## 1. Docker Application for PostgreSQL with Preloaded Table

Code Link: 

The project includes 
1. a DB dump file: This dump file is generated by running `pg_dump` on exisiting DB table. 
2. dockerfile: this docker file will create a postgres image with preloaded data using the DB dump file
3. Makefile: this is not the best make file, but get the simple job doing, run `make build` will build the image and run the container. 

To run 
```
# start DB container
make build  

# check DB content
docker ps   
docker exec -it <container_id> bash
psql -U ziyan
# in psql
SELECT * FROM note; // return 3 entires 
# \q 

# stop container
docker stop <container_id> 

```

## 2. Connect to DB through JDBC 

Code Link: 

This is the JDBC part of this example. This 50 lines of code includes: add postgres JDBC driver as maven dependency, use bare metal JDBC connection to connect to postgres and query, use HikariCP to use connection pool. If DB server or conatiner is not running, will get exception. So before calling DB connect, DB should be up and running.

To run 
```
mvn package
java -cp target/ExamplePgJdbc-1.0-SNAPSHOT.jar org.example.Main
```

## References: (The real gist)
1. PostgreSQL dump and restore db data https://www.postgresql.org/docs/current/backup-dump.html
1. Preload Postgres Docker https://cadu.dev/creating-a-docker-image-with-database-preloaded/ 
1. Postgres Cheatsheet https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546#file-postgres-cheatsheet-md
1. PostgreSQL JDBC Driver https://jdbc.postgresql.org/
1. Postgres JDBC Driver gpjdbc gpjdbc source code https://github.com/pgjdbc/pgjdbc
1. Setup PostgreSQL JDBC Driver https://jdbc.postgresql.org/documentation/setup/
1. JDBC Tutorial https://docs.oracle.com/javase/tutorial/jdbc/basics/gettingstarted.html 
1. JDBC API Doc https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/ 
1. JDBC Wikipedia https://en.wikipedia.org/wiki/Java_Database_Connectivity
1. Marco Behler Bare Metal JDBC Blog https://www.marcobehler.com/guides/jdbc
1. HikariCP connection pool https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing 





